<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,Chrome=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=9,E=8,IE=7,IE=6" />
    <meta name="renderer" content="webkit|ie-comp|ie-stand" />
    <title>达飞电子签名系统</title>
    <link href="Content/css/style.css" rel="stylesheet" />
    <script type="text/javascript" src="/Scripts/jquery-1.8.2.js"></script>
    <script type="text/javascript" src="/Scripts/isIdCardNo.js"></script>
    <script type="text/javascript">
        var wRevision;
        var successfulId = ""; // 1:成功； 其他失败
        var FuntuosTabletIsEmpty;
        var isChrome;
        var PLUGIN; //火狐 谷歌


        function signPDF(ddPdfOperatorType, SignStep, func, btn) {

            var data = "";
            var noSignImg = false;
            var signImg = TabletSaveBase64();
            var checkImg = $(btn).attr("checkImg") == "1";


            //  alert(encode(signImg));

            successfulId = "";

            if (func != '') {
                data = eval(func);
                if (data == '') return;
            }

            if (FuntuosTabletIsEmpty == '') {
                noSignImg = true;
            } else {
                if (FuntuosTabletIsEmpty == signImg) // 金格写字板内容判断
                {
                    noSignImg = true;
                }

            }

            if (checkImg) {
                if (noSignImg == true) // 金格写字板内容判断
                {
                    alert("手写签名为空！");
                    return false;
                }
            }


            startload();

            if (!confirm(" 请确认：" + $(btn).val() + " ?")) return;

            // 提交签名
            var aj = $.ajax({
                url: '/Signature/iServerBatch', // 跳转到 action     
                data: {
                    pdfoperatortype: $("#" + ddPdfOperatorType).val(),
                    funtuosImg: signImg,
                    sampleImg: $("#sampleimg").val(),
                    signStep: $("#" + SignStep).val(),
                    append: data,
                    sign: 'pdWciFEd+nOPQcHpHO7e1DxIjYQE0OSyn+bRb0A/UAfxeH2F5QO/VkkRN6hYIejEU4UAwAnXigveoh2jN5dGN2eCrVGiZJaGOqDCSp9FVdDCW/UTrGELrVyFnsN8uwzIkqXu/1jPHZkfTtC7y2Lrtm9Go97F+QE98P2GqiiSfr8=',
                    signContent: 'R3/MqxX5o4Jazro8W8JmJL7dutw06RV5XpHhk+NaPvfuEHXrKUEWRrS/J81AF2Z9lZzTrmvTulyc3KrWy8oBK01BTy9DI7boraXgA4ZCYdxEdq5XHrWZHCt0eDivkir8c9yyuIpED5YMw7SDDffKfr66CoGxOV4CU9/EBb0xlHQ=|Cra8165fkq9B7F0xDeGKtUw1aGlBemf3Byj819yVT4TFSOafOVKzahijLc/r8WmJ6JxrjsHuYpOLUesm3sVefR11NSnE/yfAbosWesQOVArC++MZnVxo58kRbuKST6Nyy+Ca82dxbSEZL8evUXTiayX8FF4YQhDFXOVDalUM5FI=|5bISjD6qm+gPtqwGaPHjEpEyuzAu/+GeTKpJXhTQ7jcY2CIotbhqwp/2woMoycH+qLFKQ8Z4VvFnIRey0lXvZzzCs2KtaB7MLQZOsjfmaBU5uDupLMi6XaWuUHrhCEKTJXzvZXB7JynMa/unfGtIyPpZlid3s8PJ+LlWSURzl2o=|WpudjQaWneLLpSjOGDqNpkKyQ4JVb5Y2n8V/vAsMYYlRwrarTYRxtFUaKhrThU9NPiaKfz5sZos9ryYwICfGuhFTxK0RUXYHjuzcxXyO4d2xjpEk4cAo/UGuit1l96kQBN0LD52x5BEx1EEOhTkOoTc/eLJA0uCl0v8zeQpG/WA=|wBkFa2TN0vj5X3zaNyx6JYyYHcFhDhARh1mOyDT7mvPPSYFZpZ7MpUPzDd8G0PcukKMlUC3H4XW5dk5aQGE0dC6scXW9yyNoNke5DkUuQ8LFfBsxc2O3MHfe2/4wQ3hTZ/1jaxcnknT5avyHfLYyG3nG08judAs2VYx+F2sHY3E=|L4jQKQbwlRoHpfeEUQivDovX6Fg/0ohp/FZ9kYntufq/dzWpxwf4jesfNfxeRHlROfjUbuAaRd460WD360jerLl2jsL4E0/ZEbGsvFcuttrIf/zxJvVE9vYnwVfX+m3E8nDhPCq+O51jVkdsWAI+F583rl0YI6jJW/Zar+JRZFE=|E1EDw+gesrIuMNtcAhmjvwd3jwxO8SWMH7DuzGsXmBysiDstV5sbfoSV2Qu8a9cJHQAttLSRy/OhG5G0FOuoXSHystcOIZt1m5mbnCJogVG3mA6Au9ztVSUSwFUsx5TsGEvg8ik2OJjhsv1/nkYo0y3+dckqV+84syOek9kqBiM=|jp+OmpgVlROFGOoJztJRvYQz4HU2wMvhWWsNK9DoVbOXNxpSz/d/N45A/6qC1X7ULPPixal95BYAiUxPa+Vtv1/oSMdXU60oB4T17Z0qERPZmIqqhc1x8wf7TUDxg649fLt7yyiRM0yZwkGeTovZgRBCbofvrjJV14iGvH3oq3g=|buJP/RleSUHIj7itwqNZ9mju9DjOU1V9MauyIh/U+a732KHbarfjOlsRjsxXqHJSDfzvg1bRfhkyB6ygtXHB+7DvAXYukL+95t71iplguWRBc3cmy9vpBVXWVBSkiDCV0h1tYNYjkYSEp6kmTdHQCVWDkFrDW7471ckym0wyfmw=|',
                    submitKey: $("#submitKey").val()

                },
                async: false,
                type: 'post',
                cache: false,
                dataType: 'json',
                success: function (data) {
                    getServerMsg(data, btn);

                },
                error: function (err) {
                    getServerMsg(err, btn);
                }
            });
            //提交签名


        }

        // 获取服务端返回信息
        function getServerMsg(data, btnObj) {
            var id = data.ResultCode;
            var msg = unescape(data.Msg);
            viewResult(id, msg);

            if (id != "1") {
                alert("服务器操作失败：" + successfulId + "\n");
                return;
            } else {

                $(btnObj).attr({ "disabled": "disabled" });
                signClear();
                alert("操作成功！");
            }


        }


        function startload() {
            $("#resultdiv").html("加载数据中，请稍等。。。");
            // alert("load end");
        }


        function viewResult(id, message) {


            $("#resultdiv").html(message);
            if (id != "1") {
                $("#resultdiv").css("background-color", "#FF0000");
            } else {
                $("#resultdiv").css("background-color", "#00FF00");
            }
        }


        function signClear() {
            // alert(wRevision.Modify + "||");
            // wRevision.ClearAll();
            TabletClean();
        }

        //2015-5-7
        window.onunload = function () {
            if (isChrome) {
                PLUGIN.FuntuosTabletClose();
            } else {
                FuntuosTablet.FuntuosTabletClose();
            }


        }

        function TabletSaveBase64() {
            var img;

            if (!isChrome) {
                img = FuntuosTablet.FuntuosTabletImageBase64Save(0x00, 0);
                return img;
            } else {
                img = PLUGIN.FuntuosTabletImageBase64Save(0x00, 0);
                return img;
            }


        }

        function TabletClean() {
            if (isChrome) {
                PLUGIN.FuntuosTabletClean();
            } else {
                FuntuosTablet.FuntuosTabletClean();
            }

            // alert("PLUGIN.FuntuosTabletClean");

        }


        function init() {
            // 凡拓写字打开 2015-5-7

            open_tablet();
            TabletClean();
            FuntuosTabletIsEmpty = TabletSaveBase64();

            addTestData();

        }


        function addTestData() {
            // 测试数据
            $("#clerk_Name").val("卜雅艳");
            $("#clerk_Ident").val("51170219870626850X");
        }


        //function confirm(message) {
        //    return confirm(message);
        //}


        function open_tablet() {
            if (isChrome) {
                PLUGIN.FuntuosTabletOpen();
            } else {
                FuntuosTablet.FuntuosTabletOpen();
            }


        }


        function GetPLUGIN(f) {

            if (f == '1') {
                isChrome = true;
                // alert("plugin--start");
                PLUGIN = document.getElementById('plugin');
                //  alert("PLUGIN=" + PLUGIN);
                //  alert("plugin--end");
            } else {
                isChrome = false;
                //  PLUGIN = document.getElementById('FuntuosTablet');
            }

            //alert("isChrome=" + isChrome);
        }


        function viewPdfList(contractNo) {
            frm.action = "PDFBatchView/GetPDFList";
            frm.submit();
        }

        function DownFile(id) {
            // frm.action = "PDFBatchView/DownFile?id=" + id;
            location.href = "PDFBatchView/DownFile?id=" + id;
            // frm.submit();
        }

    </script>
</head>
<body onload="init()">
    <div class="main_box" style="width:800px;">
        <div>
            <img src="Content/images/tip.jpg" />
        </div>
        <div class="box_list" style="font-size:16px;font-family:KaiTi;color:black;">
            <p>
                亲爱的小伙伴：<br />
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;你们好！我真心的希望你可以参加我在3月10号的生日派对，我们会度过一个愉快又记得回忆的晚上，
                我们可以把酒畅谈，回忆我们曾经的往事与趣事，再次真诚的邀请你。
            </p>
            <p>
                地址：在深圳北站地铁下车，转M352到松仔园下车，松发餐厅 <br />
                时间：2016年3月10号晚上8点到10点
            </p> 
        </div>
    </div>
</body>
</html>